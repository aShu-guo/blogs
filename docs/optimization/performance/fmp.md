# FMP -- 首屏绘制速度

英文全称为：First Meaningful Paint

测量页面的基本内容加载速度

:::warning
FMP在lighthouse 6.x版本中废弃
:::

## 什么是页面的基本内容？

页面的基本内容与页面类型有关：

例如：

- 博客页面：基本内容为标题和可视区域文案（不包含字体加载）
- 搜索引擎：基本内容为可视区域的搜索结果（如果有图片则包含）

那么如何区分页面类型呢？目前并没有统一的标准定义

## FMP与FCP的区别？

首次有效绘制与首次内容绘制在大多数情况下是值是相同的，但是它们的计算方式是不同的：

首次有效绘制测量的是页面的首屏绘制，可以简化为从初始化到用户看到可视部分的页面需要的时间

首次内容绘制测量的也是从初始化到用户看到可视部分的页面需要的时间。但是它只测量以下**内容**：

- 文本
- 图像（包括背景图像）
- svg元素
- 非白色的canvas

那么什么情况下它们的值是不同的呢？

例如，一个包含iframe页面的FMP和FCP的值不同，FMP的值中包含iframe的加载时间，而FCP不包含。

## 如何跟踪用户真实世界的FMP值呢？

这里W3C并没有提供标准的API，国内计算FMP大多数依据阿里的最高可见增量元素原则：即统计DOM元素数量根据时间变化的曲线图，k值最大时的时间即为FMP值。

大致流程为：

1. 通过MutationObserve监听DOM加载
2. 标记面积不为0和可见的元素（依据深度优先原则），并在load触发时停止监听DOM树
3. 根据元素权重计算分值

参考：

【1】[前端性能监控](https://caelumtian.github.io/2019/10/22/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A71/)

【2】[阿里FMP前端监控](https://zhuanlan.zhihu.com/p/44933789)

【3】[W3C进行中的首屏绘制标准](https://github.com/w3c/paint-timing)

【4】[以用户为中心的性能指标](https://web.dev/user-centric-performance-metrics/#in-the-field)
